{% extends "base.html" %}

{% block title %}Plan Details | Gym SaaS{% endblock %}

{% block content %}

<div class="row">

  <!-- Plan Info -->
  <div class="col-md-4">
    <div class="card shadow-sm mb-3">
      <div class="card-header bg-primary text-white">
        Plan Info
      </div>

      <div class="card-body">
        <form
          method="POST"
          action="{{ url_for('api_v1.plan.update_plan', plan_id=plan.id) }}"
        >

          <div class="mb-2">
            <label>Name</label>
            <input
              type="text"
              name="name"
              class="form-control"
              value="{{ plan.name }}"
              required
            >
          </div>

          <div class="mb-2">
            <label>Duration (months)</label>
            <input
              type="number"
              name="duration_months"
              class="form-control"
              value="{{ plan.duration_months }}"
              required
            >
          </div>

          <div class="mb-2">
            <label>Price</label>
            <input
              type="number"
              step="0.01"
              name="price"
              class="form-control"
              value="{{ plan.price }}"
              required
            >
          </div>

          <div class="mb-2">
            <label>Description</label>
            <input
              type="text"
              name="description"
              class="form-control"
              value="{{ plan.description }}"
            >
          </div>

          <button class="btn btn-success w-100 mt-2">
            Update Plan
          </button>
        </form>
      </div>

      {% if plan.is_active %}
      <div class="card-footer">
        <form
          method="POST"
          action="{{ url_for('api_v1.plan.deactivate_plan', plan_id=plan.id) }}"
          onsubmit="return confirm('Deactivate this plan?');"
        >
          <button class="btn btn-sm btn-outline-danger w-100">
            Deactivate Plan
          </button>
        </form>
      </div>
      {% endif %}
    </div>
  </div>

  <!-- Memberships -->
  <div class="col-md-4">
    <div class="card shadow-sm mb-3">
      <div class="card-header bg-dark text-white">
        Active Memberships
      </div>

      <div class="card-body">
        {% for m in memberships %}
          {% if m.plan_id == plan.id %}
          <div class="border rounded p-2 mb-2">
            <div><strong>Member:</strong> {{ m.member.name }}</div>
            <div><strong>Ends:</strong> {{ m.end_date }}</div>
          </div>
          {% endif %}
        {% else %}
          <p class="text-muted">No memberships for this plan</p>
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Payments -->
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-header bg-secondary text-white">
        Payments
      </div>

      <div class="card-body">
        {% for p in payments %}
          {% if p.plan_id == plan.id %}
          <div class="border rounded p-2 mb-2">
            <div>â‚¹{{ p.amount }}</div>
            <div class="text-muted small">{{ p.payment_method }}</div>
          </div>
          {% endif %}
        {% else %}
          <p class="text-muted">No payments for this plan</p>
        {% endfor %}
      </div>
    </div>
  </div>

</div>

{% endblock %}